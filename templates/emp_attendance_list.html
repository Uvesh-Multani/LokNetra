{% extends 'base.html' %}
{% block title %}Attendance List | LokNetra{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="mb-0">Attendance Records</h2>
  <a href="{% url 'emp_attendance_list' %}?download_report=1" class="btn btn-outline-primary"><i class="fas fa-file-export me-1"></i> Export</a>
</div>
<div class="mb-3">
  <input type="text" class="form-control" id="attendanceSearch" placeholder="Search attendance records...">
</div>
<div class="table-responsive">
  <table class="table table-striped table-hover align-middle" id="attendanceTable">
    <thead class="table-primary">
      <tr>
        <th scope="col">#</th>
        <th scope="col">Employee</th>
        <th scope="col">Date</th>
        <th scope="col">Check-In</th>
        <th scope="col">Check-Out</th>
        <th scope="col">Duration</th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for record in attendance_records %}
      <tr>
        <th scope="row">{{ forloop.counter }}</th>
        <td>{{ record.employee.name }}</td>
        <td>{{ record.date|date:"M d, Y" }}</td>
        <td>
          {% if record.check_in_time %}
            <span class="badge bg-success">{{ record.check_in_time|time:"H:i:s" }}</span>
          {% else %}
            <span class="badge bg-secondary">Not Checked In</span>
          {% endif %}
        </td>
        <td>
          {% if record.check_out_time %}
            <span class="badge bg-info">{{ record.check_out_time|time:"H:i:s" }}</span>
          {% else %}
            <span class="badge bg-warning">Not Checked Out</span>
          {% endif %}
        </td>
        <td>
          {% if record.check_in_time and record.check_out_time %}
            <span class="badge bg-primary">{{ record.calculate_duration }}</span>
          {% else %}
            <span class="text-muted">-</span>
          {% endif %}
        </td>
        <td>
          <div class="btn-group" role="group">
            <a href="{% url 'emp-detail' record.employee.pk %}" class="btn btn-sm btn-info" title="View Employee Details"><i class="fas fa-user"></i></a>
            <a href="{% url 'emp-authorize' record.employee.pk %}" class="btn btn-sm btn-warning" title="Authorize Employee"><i class="fas fa-key"></i></a>
          </div>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="7" class="text-center text-muted">No attendance records found.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
{% block extra_scripts %}
<script>
  document.getElementById('attendanceSearch').addEventListener('keyup', function() {
    var value = this.value.toLowerCase();
    var rows = document.querySelectorAll('#attendanceTable tbody tr');
    rows.forEach(function(row) {
      var text = row.textContent.toLowerCase();
      row.style.display = text.includes(value) ? '' : 'none';
    });
  });
</script>
{% endblock %}
